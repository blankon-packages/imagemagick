Description: Disable the MAGICKCORE_HAVE_POPEN
  This removes support for the pipe (|) prefix for
  reading/writing from/to a shell command.
Origin: http://www.openwall.com/lists/oss-security/2016/05/29/7
Origin: http://git.imagemagick.org/repos/ImageMagick/commit/ca430ff77794980941ff0fa0d2fc463b50c2c6b7
Bug-CVE: CVE-2016-5118
Bug-Debian: https://bugs.debian.org/825799

--- a/configure.ac
+++ b/configure.ac
@@ -706,6 +706,18 @@
 CFLAGS="$CFLAGS -DMAGICKCORE_HDRI_ENABLE=$magick_hdri_enable"
 CPPFLAGS="$CPPFLAGS -DMAGICKCORE_HDRI_ENABLE=$magick_hdri_enable"
 
+# Enable pipes (|) in filenames.
+AC_ARG_ENABLE([pipes],
+    [AC_HELP_STRING([--enable-pipes],
+                    [enable pipes (|) in filenames])],
+    [enable_pipes=$enableval],
+    [enable_pipes='no'])
+
+if test "$enable_pipes" = 'yes'; then
+    AC_DEFINE(PIPES_SUPPORT,1,[enable pipes (|) in filenames])
+    MAGICK_FEATURES="Pipes $MAGICK_FEATURES"
+fi
+
 # Build a version of ImageMagick with assert statements.
 AC_ARG_ENABLE([assert],
     [AC_HELP_STRING([--disable-assert],
--- a/magick/blob.c
+++ b/magick/blob.c
@@ -2494,7 +2494,7 @@
       image->blob->exempt=MagickTrue;
       return(MagickTrue);
     }
-#if defined(MAGICKCORE_HAVE_POPEN)
+#if defined(MAGICKCORE_HAVE_POPEN) && defined(MAGICKCORE_PIPES_SUPPORT)
   if (*filename == '|')
     {
       char
